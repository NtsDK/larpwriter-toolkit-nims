<!DOCTYPE html>

<!-- Copyright 2015 Timofey Rechkalov <ntsdk@yandex.ru>, Maria Sidekhmenova <matilda_@list.ru>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
   limitations under the License.  -->

<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>НИМС набор инструментов мастера сюжетника</title>

<link rel="stylesheet" href="style/bootstrap.min.css" >
<link rel="stylesheet" type="text/css" href="style/common.css"  media="screen" />
<link rel="stylesheet" type="text/css" href="style/style.css"  media="screen" />
<link rel="stylesheet" type="text/css" href="style/experimental.css"  media="screen" />

<link rel="stylesheet" type="text/css" href="libs/vis.css"/>
<script src="mode.js"></script>
<script src="libs/vis.js"></script>

<link rel="stylesheet" type="text/css" href="libs/jquery.datetimepicker.css"/>
<script src="libs/jquery-2.1.4.js"></script>
<script src="libs/bootstrap.min.js"></script>
<script src="libs/jquery.datetimepicker.js"></script>

<script src="libs/FileSaver.js"></script>
<script src="libs/jszip-utils.js"></script>
<script src="libs/jszip.js"></script>


<!-- <script src="libs/docxgen.js"></script> -->
<script src="libs/docxgen.min.js"></script>

</head>
<body onload="PageManager.onLoad()">

  <script src="js/utils.js"></script>
  <script src="js/fileUtils.js"></script>
  <script src="js/common/baseExample.js"></script>
  <script src="js/common/emptyBase.js"></script>
  <script src="js/common/constants.js"></script>
  <script src="js/common/migrator.js"></script>
  <script src="js/common/commonUtils.js"></script>
  <script src="js/common/dateFormat.js"></script>
  <script src="js/common/errors.js"></script>
  <script src="js/common/engine/common.js"></script>
  <script src="js/common/engine/charactersAPI.js"></script>
  <script src="js/common/engine/extrasAPI.js"></script>
  <script src="js/common/engine/briefingExportAPI.js"></script>
  <script src="js/common/engine/profileConfigurerAPI.js"></script>
  <script src="js/common/engine/storiesAPI.js"></script>
  <script src="js/common/engine/eventsAPI.js"></script>
  <script src="js/common/engine/accessManagerAPI.js"></script>
  
  <script src="js/dbms/localDBMS.js"></script>
  <script src="js/dbms/remoteDBMS.js"></script>

  <script src="js/pageManager.js"></script>
  
  <script src="js/overview.js"></script>

  <script src="js/characters.js"></script>
  <script src="js/characterProfile.js"></script>
  <script src="js/characterFilter.js"></script>
  <script src="js/characterProfileConfigurer.js"></script>

  <script src="js/stories.js"></script>
  <script src="js/storyEvents.js"></script>
  <script src="js/storyCharacters.js"></script>
  <script src="js/eventPresence.js"></script>

  <script src="js/events.js"></script>

  <script src="js/briefings.js"></script>
  <script src="js/briefingExport.js"></script>
  <script src="js/briefingPreview.js"></script>

  <script src="js/timeline.js"></script>
  <script src="js/network/socialNetwork.js"></script>
  <script src="js/network/networkSubsetsSelector.js"></script>

  <script src="js/accessManager.js"></script>
  <script src="js/chat.js"></script>
  <script src="js/permissionInformer.js"></script>

  <div id="navigation">
  
  </div>

  <div class="block" id="contentArea"></div>

  <div class="hidden">
    <div id="overviewDiv">
      <div class="panel panel-default">
        <div class="panel-body">
          <table>
            <tr>
              <td><span>Название</span></td>
              <td><input id="gameNameInput" class="adminOnly"></input></td>
            </tr>
            <tr>
              <td><span>Дата начала доигровых событий</span></td>
              <td><input id="preGameDatePicker" class="adminOnly"></input></td>
            </tr>
            <tr>
              <td><span>Дата окончания доигровых событий</span></td>
              <td><input id="gameDatePicker" class="adminOnly"></input></td>
            </tr>
          </table>
        </div>
      </div>
    
      <div style="display:flex;justify-content: space-around;">
        <div class="panel panel-default" style="flex-grow:0;">
          <div class="panel-heading">
            <h3 class="panel-title">Описание</h3>
          </div>
          <div class="panel-body"><textarea id="gameDescription" class="adminOnly"></textarea></div>
        </div>
        <div class="panel panel-default" style="flex-grow:0;flex-basis: 300px;">
          <div class="panel-heading">
            <h3 class="panel-title">Статистика</h3>
          </div>
          <div class="panel-body"></div>
        </div>
      </div>
    </div>


    <div id="charactersDiv">

      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Управление персонажами</h3>
        </div>
        <div class="panel-body">
          <input id="characterNameInput"  placeholder="Имя персонажа"></input>
          <button id="createCharacterButton">Добавить</button>
          <br> Переименовать из <select id="fromName"></select> в <input
            id="toName" placeholder="Новое имя персонажа"></input>
          <button id="renameCharacter">OK</button>
          <br> <select id="characterRemoveSelector"></select>
          <button id="removeCharacterButton">Удалить</button>
        </div>
      </div>
    
      <div id="charactersNavigation"></div>
      <div id="charactersContent"></div>
    </div>


      
    <div id="characterProfile">
      <div class="panel panel-default">
        <div class="panel-body">
          <table>
            <tr>
              <th>Персонажи</th>
            </tr>
            <tr>
              <td><select size=20 id="bioEditorSelector"></select></td>
              <td>
                <div id="profileContentDiv"></div>
              </td>
            </tr>
          </table>
        </div>
      </div>

    </div>

    <div id="characterProfileConfigurer">
      <div class="panel panel-default">
        <div class="panel-body">
          Название<input id="profileItemNameInput" class="itemNameInput adminOnly"></input> 
          Тип<select id="profileItemTypeSelector" class="adminOnly"></select> 
          Позиция <select id="profileItemPositionSelector" class="adminOnly"></select>
          <button id="createProfileItemButton" class="adminOnly">Добавить</button>
          <br> <select id="moveProfileItemSelector" class="adminOnly"></select> Позиция
          <select id="moveProfileItemPositionSelector" class="adminOnly"></select>
          <button id="moveProfileItemButton" class="adminOnly">Переместить</button>
          <br> <select id="removeProfileItemSelector" class="adminOnly"></select>
          <button id="removeProfileItemButton" class="adminOnly">Удалить</button>
          <br>
    
          <table class="table table-bordered" style="width: auto;">
          <thead>
            <tr>
              <th>№</th>
              <th>Название поля</th>
              <th>Тип</th>
              <th>Значения</th>
            </tr>
          </thead>
          <tbody id="profileConfigBlock"></tbody>
          </table>
        </div>
      </div>

    </div>
    

    <div id="characterFilterDiv">
      <table>
        <tr>
          <td>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">Фильтр</h3>
              </div>
              <div class="panel-body">
                <div id="filterSettingsDiv"></div>
              </div>
            </div>
          </td>
          <td>
            <div class="panel panel-default">
              <div class="panel-body">
                <table  class="table table-striped table-bordered">
                <thead id="filterHead"></thead>
                <tbody id="filterContent"></tbody>
                </table>
              </div>
            </div>
          </td>
        </tr>
      </table>
    </div>
    


    <div id="storiesDiv">
      <div style="display: flex;justify-content:space-around;">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Истории</h3>
          </div>
          <div class="panel-body">
            <select id="storySelector"></select>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Управление историями</h3>
          </div>
          <div class="panel-body">
            <input id="createStoryName"  placeholder="Название истории"></input>
            <button id="createStoryButton">Добавить</button>
            <br> Переименовать из <select id="fromStory"></select> в <input
              id="toStory" placeholder="Новое название истории"></input>
            <button id="renameStoryButton">OK</button>
            <br> <select id="storyRemoveSelector"></select>
            <button id="removeStoryButton">Удалить</button>
          </div>
        </div>
      </div>

      <div>
        <div style="display:flex;">
          <div style="width:50%;display:flex;margin-right:10px;">
            <div class="navigation-button" id="masterStoryNavButton">Мастерская история</div>
          </div>
          <div id="storiesNavigation"></div>
        </div>
        <div style="display:flex;">
          <div style="flex-grow:1;width:50%;margin-right:10px;" id="masterStoryDiv">
            <div class="panel panel-default">
              <div class="panel-body">
                 <textarea id="masterStoryArea" class="isStoryEditable"></textarea>
              </div>
            </div>
          </div>
          <div id="storiesContent" style="flex-grow:1;width:50%;"></div>
        </div>
      </div>

    </div>




    <div id="storyEventsDiv">
      <div class="panel panel-default">
        <div class="panel-body">
          <div style="display:flex;flex-wrap:wrap;justify-content:space-around;">
            <div style="flex-grow:1;margin-right:10px;">
              <h3 style="margin-top:8px;">Создание события</h3>
              Название<input id="eventNameInput" class="isStoryEditable"></input><br>
              Описание события<br>
              <textarea id="eventTextInput" class="eventText isStoryEditable"></textarea><br>
              Позиция<select id="positionSelector" class="isStoryEditable"></select>
              <button id="createEventButton" class="isStoryEditable">Добавить</button>
            </div>
            <div style="flex-grow:1;">
              <h3 style="margin-top:8px;">Управление событиями</h3>
              <select id="moveEventSelector" class="isStoryEditable"></select> 
              Позиция<select id="movePositionSelector" class="isStoryEditable"></select>
              <button id="moveEventButton" class="isStoryEditable">Переместить</button>
              <br> <select id="cloneEventSelector" class="isStoryEditable"></select>
              <button id="cloneEventButton" class="isStoryEditable">Клонировать</button>
              <br> <select id="mergeEventSelector" class="isStoryEditable"></select>
              <button id="mergeEventButton" class="isStoryEditable">Объединить со следующим</button>
              <br> <select id="removeEventSelector" class="isStoryEditable"></select>
              <button id="removeEventButton" class="isStoryEditable">Удалить</button>
            </div>
          </div>
          
        </div>
      </div>

      <div class="panel panel-default">
        <div class="panel-body">
          <table class="table table-bordered">
            <thead id="eventBlockHead"></thead>
            <tbody id="eventBlock"></tbody>
          </table>
        </div>
      </div>
    </div>



    <div id="storyCharactersDiv">
      <div class="panel panel-default">
        <div class="panel-body">
          <h3>Управление персонажами</h3>
          <select id="storyCharactersAddSelector" class="isStoryEditable"></select>
          <button id="storyCharactersAddButton" class="isStoryEditable">Добавить</button>
          <br> Заменить<select id="storyCharactersFromSelector" class="isStoryEditable"></select>
          на <select id="storyCharactersToSelector" class="isStoryEditable"></select>
          <button id="storyCharactersSwitchButton" class="isStoryEditable">ОК</button>
          <br> <select id="storyCharactersRemoveSelector" class="isStoryEditable"></select>
          <button id="storyCharactersRemoveButton" class="isStoryEditable">Удалить</button>
          <br> <br>
    
          <div style="display:flex;flex-wrap: wrap; justify-content:space-around;">
            <div style="flex-grow:0;margin-right:10px;max-width: 450px;">
              <h3>Инвентарь</h3>
              <table class="table table-bordered">
                <thead id="storyCharactersTableHead"></thead>
                <tbody id="storyCharactersTable"></tbody>
              </table>
            </div>
            <div style="flex-grow:1;max-width: 450px;">
              <h3>Активность</h3>
              <table class="table table-bordered table-striped">
                <thead id="story-characterActivityTableHead"></thead>
                <tbody id="story-characterActivityTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="eventPresenceDiv">
      <div class="panel panel-default">
        <div class="panel-body" style="overflow-x:auto;">
          <table  cellspacing=0 cellpadding=0 class="table table-bordered">
            <thead id="eventPresenceTableHead"></thead>
            <tbody id="eventPresenceTable"></tbody>
          </table>
        </div>
      </div>
    </div>



    <div id="eventsDiv">
      <div class="panel panel-default">
        <div class="panel-body">
          <input type="checkbox" id="finishedStoryCheckbox"/>Показывать
          только незавершенные истории
        </div>
      </div>
      <div style="display:flex;">
        <div style="flex-grow:0;">
            <div id="personalStoriesCharacterContainer">
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">История</h3>
                </div>
                <div class="panel-body">
                  <select id="events-storySelector" size=10></select>
                </div>
              </div>
              <div class="panel panel-default">
                <div class="panel-heading">
                  <h3 class="panel-title">Персонажи</h3>
                </div>
                <div class="panel-body">
                  <select id="events-characterSelector" multiple size=15></select>
                </div>
              </div>
            </div>
          </div>
            <div class="panel panel-default" style="flex-grow:1;">
              <div class="panel-heading">
                <h3 class="panel-title">Адаптации</h3>
              </div>
              <div class="panel-body">
                 <div class="eventMainPanelRow" style="margin:0;">
                   <div class="eventMainPanelRow-left">
                     <h3>Оригинал</h3>
                   </div>
                   <div class="eventMainPanelRow-right">
                     <h3>Адаптация</h3>
                   </div>
                 </div>
                 <div id="personalStories">
                 </div>
              </div>
            </div>
      </div>
    </div>

    <div id="briefingsDiv">
      <div id="briefingsNavigation"></div>
      <div id="briefingsContent" ></div>
    </div>

    <div id="accessManagerDiv">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Управление пользователями</h3>
        </div>
        <div class="panel-body">
          Имя<input id="userNameInput" class="adminOnly"></input>
          Пароль<input id="userPasswordInput" class="adminOnly"></input>
          <button id="createUserButton" class="adminOnly">Добавить</button>
          <br> Сменить пароль <select id="passwordUserName" class="adminOnly"></select> на <input
            id="newPassword" class="adminOnly"></input>
          <button id="changePasswordButton" class="adminOnly">OK</button>
          <br> <select id="userRemoveSelector" class="adminOnly"></select>
          <button id="removeUserButton" class="adminOnly">Удалить</button>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Специальные действия</h3>
        </div>
        <div class="panel-body">
        	Администратор:<span id="currentAdministrator"></span><br>
        	<select id="newAdminSelector" class="adminOnly"></select>
            <button id="newAdminButton" class="adminOnly">Назначить администратором</button><br>
        	Редактор:<span id="currentEditor"></span>
            <button id="removeEditorButton" class="editorOrAdmin">Удалить редактора</button><br>
        	<select id="newEditorSelector" class="adminOnly"></select>
            <button id="newEditorButton" class="adminOnly">Назначить редактора</button><br>
        	Назначение прав на адаптации<br>
        	<input type="radio" name="adaptationRights" class="adaptationRights adminOnly" value="ByStory" id="adaptationRightsByStory">По историям</input><br>
		    <input type="radio" name="adaptationRights" class="adaptationRights adminOnly" value="ByCharacter" id="adaptationRightsByCharacter">По персонажам</input><br>
        </div>
      </div>
      <div id="accessManagerContent" >
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Права на редактирование</h3>
          </div>
          <div class="panel-body">
             <table>
               <tr>
                 <th>Права</th>
                 <th>Персонажи</th>
                 <th>Истории</th>
               </tr>
               <tr>
                 <td><div id="permissionTable" style="width:400px;word-wrap: break-word;"></div></td>
                 <td><select size=10 id="characterPermissionSelector" multiple></select></td>
                 <td><select size=10 id="storyPermissionSelector" multiple></select></td>
                 <td><select size=5 id="userPermissionSelector"></select>
                 <button id="assignPermissionButton">Назначить права</button>
                 <button id="removePermissionButton" class="adminOnly">Забрать права</button>
                 </td>
               </tr>
             </table>
          </div>
        </div>
      </div>
    </div>

    <div id="briefingPreviewDiv">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title">Настройки</h3>
        </div>
        <div class="panel-body">
          <input type="radio" name="eventsGroupBy" value="story" 
          id="eventGroupingByStoryRadio"/>Группировать события по историям <br> 
          <input type="radio" name="eventsGroupBy" value="time" 
          id="eventGroupingByTimeRadio"/>Сортировать события по хронологии <br> 
        </div>
      </div>
      
      <div class="panel panel-default">
        <div class="panel-heading">
          <h3 class="panel-title"><select id="briefingCharacter"></select></h3>
        </div>
        <div class="panel-body">
          <div id="briefingContent"></div>
        </div>
      </div>
      
      

    </div>

    <div id="briefingExportDiv">
      <div class="panel panel-default">
        <div class="panel-body">
        
          <input type="checkbox" id="toSeparateFileCheckbox"/>Каждую вводную в отдельный файл <br>
          <h3>Простая выгрузка</h3>
          <button id="makeBriefingsByTime">Сформировать вводные, события сгруппированны по времени (docx)</button><br>
          <button id="makeBriefingsByStory">Сформировать вводные, события сгруппированны по историям (docx)</button><br>
          <button id="makeBriefings">Сформировать вводные txt</button><br><br>
          
          <button id="makeInventoryList">Сформировать список инвентаря (docx)</button><br>
          <h3>Продвинутая выгрузка</h3>
          <input type="radio" name="eventsGroupBy2" value="story"
            id="eventGroupingByStoryRadio2"/>Группировать события по
          историям <br> <input type="radio" name="eventsGroupBy2"
            value="time" id="eventGroupingByTimeRadio2"/>Сортировать
          события по хронологии <br> 

              <div class="file-upload">
                   <label>
                        <input type="file" name="file" id="docxBriefings">
                        <span>Загрузить шаблон и сформировать вводные</span>
                   </label>
              </div>
        </div>
      </div>
    </div>



    <div id="timelineDiv">

      <div class="flexRoot">
        <div class="storySelectorContainer">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Истории</h3>
            </div>
            <div class="panel-body">
              <select size=20 id="timelineStorySelector" multiple></select>
            </div>
          </div>
        </div>
        <div class="visualObjectContainer full-screen-elem" id="timelineContainer"></div>
      </div>

    </div>

    <div id="logoutForm">
      <form class="form-horizontal login-form" name="login-form" method="POST" action="/logout">
        <button type="submit" class="654btn 654btn-primary" data-loading-text="Отправляю...">Выйти</button>
      </form> 
    </div>
    
    <div id="socialNetworkDiv">
      <div id="socialNetworkWarning" class="alert alert-warning"></div>
      <div class="flexRoot">
      
<!--         <div style="flex-basis:150px;flex-grow:0; display:flex;flex-direction:column;flex-wrap:wrap;height:500px"> -->
        <div class="storySelectorContainer" id="commonSettingsContainer">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title">Общие настройки</h3>
            </div>
            <div class="panel-body">
              <h4>Раскраска узлов</h4> <select
                id="networkNodeGroupSelector"></select> Легенда
              <div id="colorLegend"></div>
    
              <h4>Выборка</h4> <select size=3 id="networkSubsetsSelector"></select>
              <div id="networkCharacterDiv" class="hidden">
                <h4>Персонажи</h4> <select size=20 id="networkCharacterSelector"
                  multiple></select>
              </div>
    
              <div id="networkStoryDiv" class="hidden">
                <h4>Истории</h4> <select size=20 id="networkStorySelector" multiple></select>
              </div>
            </div>
          </div>

        </div>
        <div class="storySelectorContainer" id="privateSettingsContainer">
          <div class="panel panel-default" style="width: 200px;">
            <div class="panel-heading">
              <h3 class="panel-title">Частные настройки</h3>
            </div>
            <div class="panel-body">
              <h4>Социальная сеть</h4> <select size=4
                id="networkSelector"></select>
    
              <div id="activityBlock" class="hidden">
                <h4>Активность</h4> <select size=4 id="activitySelector" multiple></select>
              </div>
    
              <button id="drawNetworkButton">Нарисовать</button><br>
              <button id="hideNetworkSettingsButton">Спрятать панель</button>
            </div>
          </div>
        </div>
<!--         </div> -->

        <div class="storySelectorContainer2 hidden"
          id="showSettingsButtonContainer">
          <button id="showNetworkSettingsButton">+</button>
        </div>

        <div class="visualObjectContainer full-screen-elem" id="socialNetworkContainer"></div>
<!--         <div class="visualObjectContainer" style="display:flex;flex-direction:column;"> -->
<!--           <div id="socialNetworkContainer" style="flex-base:100px;flex-grow:1;"> -->
<!--         </div> -->
        </div>
      </div>
      
      <div id="chatDiv">
        <p class="lead">Добро пожаловать в чат!</p>
        <input type="text" name="message" id="chatMessage" />
        <button id="sendMessageButton">Отправить</button>
        <ul id="messages"></ul>
      </div>
    </div>


</body>
</html>